# 个人读书记录系统需求文档

## 项目概述

这是一个个人使用的读书记录系统，用于记录个人的阅读历史和读书笔记。系统支持添加书籍信息、记录阅读状态、编写读书笔记，并提供简单的搜索和统计功能。

## 一、功能需求

### 1. 书籍管理
- **添加书籍**
  - 手动录入书籍信息（书名、作者、分类、页数等）
  - 可选择录入ISBN号
  - 设定阅读状态（想读、在读、已读）
  
- **书籍信息管理**
  - 修改书籍基本信息
  - 更新阅读状态
  - 记录阅读时间（开始日期、完成日期）
  - 给书籍打分（1-5星评分）
  - 删除书籍记录

- **书籍分类**
  - 支持自定义分类（如：技术、文学、历史等）
  - 按分类浏览书籍

### 2. 读书笔记
- **笔记编写**
  - 为每本书创建多篇读书笔记
  - 支持Markdown格式编写
  - 笔记类型分类（摘录、总结、感想、一般笔记）
  - 可引用具体页码

- **笔记管理**
  - 编辑和删除笔记
  - 笔记标题和内容搜索
  - 按时间排序查看笔记

### 3. 搜索功能
- **书籍搜索**
  - 按书名搜索
  - 按作者搜索
  - 按分类筛选
  - 按阅读状态筛选
  - 按评分筛选

- **笔记搜索**
  - 在所有笔记中全文搜索
  - 在特定书籍的笔记中搜索

### 4. 统计功能
- **阅读统计**
  - 年度/月度阅读数量统计
  - 各分类阅读数量分布
  - 平均阅读速度（基于页数和阅读时间）
  - 评分分布统计

- **阅读时间线**
  - 按时间顺序显示阅读历史
  - 可视化阅读进度

## 二、技术架构

### 技术选型
**后端**: Rust + Actix-web
**数据库**: PostgreSQL
**前端**: React + TypeScript
**UI组件库**: Ant Design 或 Material-UI
**状态管理**: Redux Toolkit 或 Zustand
**HTTP客户端**: Axios
**构建工具**: Vite

### 系统架构
```
┌─────────────────┐
│  React Frontend │
│   (TypeScript)  │
└────────┬────────┘
         │ HTTP API
┌────────▼────────┐
│   Rust Backend  │
│   (Actix-web)   │
└────────┬────────┘
         │ SQL
┌────────▼────────┐
│    PostgreSQL   │
│    Database     │
└─────────────────┘
```

## 三、数据模型

### 设计理念
- **表结构拆分**：将经常更新的属性（如阅读状态、评分）独立成表，减少主表更新
- **软删除机制**：所有表支持软删除，保留历史数据
- **灵活的标签系统**：支持分类和标签两种分类方式
- **性能优化**：使用部分索引，只索引未删除的数据

### 核心数据表

详细的数据库设计请参考：[数据库设计文档](../design/database/数据库设计文档.md)

主要包含以下表：
1. **books** - 书籍基础信息表（不常更新）
2. **reading_status** - 阅读状态表（频繁更新）
3. **categories** - 分类表（支持层级）
4. **tags** - 标签表（灵活分类）
5. **book_categories** - 书籍分类关联表
6. **book_tags** - 书籍标签关联表
7. **reading_notes** - 读书笔记表
8. **note_tags** - 笔记标签关联表

### 软删除实现
所有表都包含 `deleted_at` 字段，实现软删除：
- 删除时设置 `deleted_at = CURRENT_TIMESTAMP`
- 查询时加条件 `WHERE deleted_at IS NULL`
- 支持数据恢复

## 四、API接口设计

### 书籍管理接口

#### 1. 获取书籍列表
- **URL**: `GET /api/books`
- **查询参数**:
  - `page`: 页码（默认1）
  - `limit`: 每页数量（默认20）
  - `category`: 分类筛选
  - `status`: 状态筛选
  - `search`: 搜索关键词
- **响应**:
  ```json
  {
    "data": [
      {
        "id": 1,
        "title": "Rust编程语言",
        "author": "Steve Klabnik",
        "category": "技术",
        "status": "completed",
        "rating": 5,
        "start_date": "2024-01-01",
        "finish_date": "2024-01-15"
      }
    ],
    "total": 50,
    "page": 1,
    "limit": 20
  }
  ```

#### 2. 获取书籍详情
- **URL**: `GET /api/books/{id}`
- **响应**: 完整的书籍信息

#### 3. 添加书籍
- **URL**: `POST /api/books`
- **请求体**:
  ```json
  {
    "title": "书名",
    "author": "作者",
    "isbn": "978-xxx-xxx",
    "category": "分类",
    "page_count": 300,
    "status": "to_read"
  }
  ```

#### 4. 更新书籍信息
- **URL**: `PUT /api/books/{id}`
- **请求体**: 需要更新的字段

#### 5. 删除书籍
- **URL**: `DELETE /api/books/{id}`

### 读书笔记接口

#### 1. 获取书籍的所有笔记
- **URL**: `GET /api/books/{id}/notes`
- **响应**:
  ```json
  {
    "data": [
      {
        "id": 1,
        "title": "第一章笔记",
        "content": "这是读书笔记内容...",
        "note_type": "summary",
        "page_reference": "第1-20页",
        "created_at": "2024-01-02T10:00:00Z"
      }
    ]
  }
  ```

#### 2. 添加读书笔记
- **URL**: `POST /api/books/{id}/notes`
- **请求体**:
  ```json
  {
    "title": "笔记标题",
    "content": "笔记内容（支持Markdown）",
    "note_type": "summary",
    "page_reference": "第1-10页"
  }
  ```

#### 3. 更新笔记
- **URL**: `PUT /api/notes/{id}`

#### 4. 删除笔记
- **URL**: `DELETE /api/notes/{id}`

### 搜索接口

#### 1. 搜索书籍
- **URL**: `GET /api/search/books?q=关键词`

#### 2. 搜索笔记
- **URL**: `GET /api/search/notes?q=关键词`

### 统计接口

#### 1. 阅读统计概览
- **URL**: `GET /api/stats/summary`
- **响应**:
  ```json
  {
    "total_books": 50,
    "completed_books": 45,
    "reading_books": 3,
    "to_read_books": 2,
    "total_notes": 120,
    "avg_rating": 4.2,
    "reading_days_this_year": 180
  }
  ```

#### 2. 分类统计
- **URL**: `GET /api/stats/categories`
- **响应**:
  ```json
  {
    "categories": [
      {"name": "技术", "count": 20},
      {"name": "文学", "count": 15},
      {"name": "历史", "count": 10}
    ]
  }
  ```

#### 3. 阅读时间线
- **URL**: `GET /api/stats/timeline?year=2024`

## 五、用户界面设计

### 1. 主页面
- 显示阅读统计概览
- 最近阅读的书籍
- 快速添加书籍入口

### 2. 书籍列表页
- 书籍网格/列表视图
- 分类筛选侧边栏
- 搜索框
- 状态筛选标签

### 3. 书籍详情页
- 展示书籍完整信息
- 评分组件
- 阅读状态更新
- 该书所有笔记列表
- 添加笔记按钮

### 4. 笔记编辑页
- Markdown编辑器
- 实时预览
- 笔记类型选择
- 页码引用输入

### 5. 统计页面
- 阅读数量图表
- 分类分布饼图
- 阅读时间线
- 年度阅读目标进度

## 六、开发计划

### 第一阶段：核心功能（2周）
1. 项目初始化和数据库设计
2. 书籍CRUD API实现
3. 基础前端页面（书籍列表、详情、添加）

### 第二阶段：笔记功能（1周）
1. 读书笔记CRUD API
2. Markdown编辑器集成
3. 笔记管理界面

### 第三阶段：搜索与统计（1周）
1. 搜索功能实现
2. 统计API和页面
3. 数据可视化

### 第四阶段：优化完善（1周）
1. 界面优化和响应式设计
2. 数据导入导出功能
3. 性能优化和测试

## 七、技术实现要点

### 1. 数据存储
- 使用PostgreSQL作为数据库，提供更强大的功能和性能
- 实现数据备份和恢复功能
- 支持数据导出（JSON/CSV格式）
- 使用Diesel或SeaORM作为ORM框架

### 2. Markdown支持
- 在笔记编辑时支持Markdown语法
- 使用react-markdown实现实时预览
- 集成代码高亮功能
- 导出笔记为HTML/PDF格式

### 3. 搜索功能
- PostgreSQL的全文搜索功能
- 支持中文分词（使用pg_jieba或zhparser）
- 搜索结果高亮显示
- 支持模糊搜索和精确搜索

### 4. 性能优化
- 合理使用数据库索引
- API响应数据分页
- React组件懒加载
- 使用React Query或SWR进行数据缓存
- 图片懒加载和CDN优化

### 5. 前端技术要点
- 使用TypeScript确保类型安全
- 组件化开发，提高代码复用性
- 使用React Router进行路由管理
- 响应式设计，支持移动端访问
- PWA支持，可离线访问

### 6. 后端技术要点
- RESTful API设计
- JWT认证（如需多用户支持）
- 请求参数验证
- 错误处理和日志记录
- API限流和安全防护

## 八、扩展功能（可选）

### 1. 数据同步
- 支持多设备数据同步
- 云端备份功能

### 2. 社交功能
- 分享读书笔记
- 导出为博客文章

### 3. 智能推荐
- 基于阅读历史的书籍推荐
- 相似书籍推荐

### 4. 移动端
- 响应式Web设计
- PWA支持

---

**文档版本**: 1.0  
**创建日期**: 2024-06-20  
**项目类型**: 个人读书记录系统